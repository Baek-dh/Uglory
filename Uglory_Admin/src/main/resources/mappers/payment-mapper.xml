<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="paymentMapper">

	<resultMap type="payment" id="payment_rm">
		<id property="orderCode" column="ORDER_CD" />
		<result property="customerEmail" column="MEMBER_EMAIL" />
		<result property="payAmount" column="PAY_AMOUNT" />
		<result property="payDate" column="PAY_DT" />
	</resultMap>
	
	
	
	<select id="selectAllPayment" resultMap="payment_rm">
		SELECT S.S_ORDER_CD AS ORDER_CD, M.MEMBER_EMAIL, S.S_PAY_AMOUNT AS PAY_AMOUNT, S.S_PAY_DT AS PAY_DT
		FROM SUBS_PAY S
		JOIN MEMBER M ON S.MEMBER_NO = M.MEMBER_NO
		UNION ALL
		SELECT P.P_ORDER_CD AS ORDER_CD, M.MEMBER_EMAIL, P.P_PAY_AMOUNT AS PAY_AMOUNT, P.P_PAY_DT AS PAY_DT
		FROM PRODUCT_PAY P
		JOIN MEMBER M ON P.MEMBER_NO = M.MEMBER_NO
		ORDER BY PAY_DT DESC
	</select>
	
	
	
	<select id="searchPayment" resultMap="payment_rm">
		SELECT S.S_ORDER_CD AS ORDER_CD, M.MEMBER_EMAIL, S.S_PAY_AMOUNT AS PAY_AMOUNT, S.S_PAY_DT AS PAY_DT
		FROM SUBS_PAY S
		JOIN MEMBER M ON S.MEMBER_NO = M.MEMBER_NO
		<if test='query != null and query !=""'>
			WHERE 
			<choose>
				<when test='key == "orderNo"'>
					S.S_ORDER_CD LIKE '%${query}%'
				</when>
				<when test='key == "customerEmail"'>
					MEMBER_EMAIL LIKE '%${query}%'
				</when>
				<when test='key == "orderDate"'>
					S.S_PAY_DT BETWEEN TO_DATE('${query}', 'YYYY/MM/DD') AND TO_DATE('${query}', 'YYYY/MM/DD') + 0.99999
				</when>
			</choose>
		</if>
		UNION ALL
		SELECT P.P_ORDER_CD AS ORDER_CD, M.MEMBER_EMAIL, P.P_PAY_AMOUNT AS PAY_AMOUNT, P.P_PAY_DT AS PAY_DT
		FROM PRODUCT_PAY P
		JOIN MEMBER M ON P.MEMBER_NO = M.MEMBER_NO
		<if test='query != null and query !=""'>
			WHERE 
			<choose>
				<when test='key == "orderNo"'>
					P.P_ORDER_CD LIKE '%${query}%'
				</when>
				<when test='key == "customerEmail"'>
					MEMBER_EMAIL LIKE '%${query}%'
				</when>
				<when test='key == "orderDate"'>
					P.P_PAY_DT BETWEEN TO_DATE('${query}', 'YYYY/MM/DD') AND TO_DATE('${query}', 'YYYY/MM/DD') + 0.99999
				</when>
			</choose>
		</if>
		ORDER BY PAY_DT DESC
	</select>
	

	
	
	
	
	
	
</mapper>
