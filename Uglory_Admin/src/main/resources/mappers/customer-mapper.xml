<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="customerMapper">

	<resultMap type="customer" id="customer_rm">
		<id property="customerNo" column="MEMBER_NO" />
		<result property="customerEmail" column="MEMBER_EMAIL" />
		<result property="customerName" column="MEMBER_NAME" />
		<result property="subscriptionFlag" column="S_CANCEL" />
		<result property="accountFlag" column="MEMBER_ST" />
	</resultMap>

	<!-- 전체 고객 목록 조회 -->
	<select id="selectAllCustomer" resultMap="customer_rm">
		SELECT M.MEMBER_NO, M.MEMBER_EMAIL, M.MEMBER_NAME, S.S_CANCEL, M.MEMBER_ST
		FROM MEMBER M
		LEFT JOIN SUBS_ORDER S
		ON M.MEMBER_NO = S.MEMBER_NO
		WHERE MEMBER_ST = 'N'
		ORDER BY 1
	</select>
	
	
	<!-- 특정 조건을 만족하는 고객 목록 조회 -->
	<select id="searchCustomer" resultMap="customer_rm">
		SELECT M.MEMBER_NO, M.MEMBER_EMAIL, M.MEMBER_NAME, S.S_CANCEL, M.MEMBER_ST
         FROM MEMBER M
         LEFT JOIN SUBS_ORDER S
         ON M.MEMBER_NO = S.MEMBER_NO
         WHERE MEMBER_ST = 'N'
         <if test='query != null and query !=""'>
			AND
			<choose>
				<when test='key == "customerEmail"'>
					MEMBER_EMAIL LIKE '%${query}%'
				</when>
				
				<when test='key == "customerName"'>
					MEMBER_NAME LIKE '%${query}%'
				</when>
			</choose>
		</if>
		ORDER BY MEMBER_NO 
	</select>
	
	



</mapper>
