<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mainMapper">

	<resultMap type="deliveryProduct" id="delProduct_rm">
		<result property="productCategory" column="P_CATEGORY_NM"/>
		<result property="productName" column="PRODUCT_NM"/>
		<result property="optionName" column="OPTION_NM"/>
		<result property="price" column="PRICE"/>
		<result property="thumbnail" column="THUMBNAIL"/>
	</resultMap>

	<select id="thisDeliveryProduct" resultMap="delProduct_rm">
		SELECT P_CATEGORY_NM, PRODUCT_NM, OPTION_NM, TO_CHAR((PRODUCT_PRICE + OPTION_PRICE), 'FM9,999,999') PRICE,
		       (SELECT IMG_ROOT FROM PRODUCT_IMG I
		       WHERE IMG_LEVEL = 0
		       AND I.P_CD = P.P_CD) THUMBNAIL
		FROM WEEKLY_P WP
		JOIN WEEKLY_LIST WL ON(WP.P_LIST_NO = WL.P_LIST_NO)
		JOIN OPTION_TYPE O ON(WP.OPTION_CD = O.OPTION_CD)
		JOIN PRODUCT P ON(O.P_CD = P.P_CD)
		JOIN P_CATEGORY PC ON(P.P_CATEGORY_NO = PC.P_CATEGORY_NO)
		WHERE EX_UPLOAD_DATE = 'T'
		ORDER BY PRODUCT_NO
	</select>
	
	<select id="nextDeliveryProduct" resultMap="delProduct_rm">
		SELECT P_CATEGORY_NM, PRODUCT_NM, OPTION_NM, TO_CHAR((PRODUCT_PRICE + OPTION_PRICE), 'FM9,999,999') PRICE,
		       (SELECT IMG_ROOT FROM PRODUCT_IMG I
		       WHERE IMG_LEVEL = 0
		       AND I.P_CD = P.P_CD) THUMBNAIL
		FROM WEEKLY_P WP
		JOIN WEEKLY_LIST WL ON(WP.P_LIST_NO = WL.P_LIST_NO)
		JOIN OPTION_TYPE O ON(WP.OPTION_CD = O.OPTION_CD)
		JOIN PRODUCT P ON(O.P_CD = P.P_CD)
		JOIN P_CATEGORY PC ON(P.P_CATEGORY_NO = PC.P_CATEGORY_NO)
		WHERE EX_UPLOAD_DATE = 'N'
		ORDER BY PRODUCT_NO
	</select>

</mapper>
